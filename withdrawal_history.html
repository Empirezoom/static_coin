<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Withdrawal History ‚Äî ORYX</title>
    <link rel="icon" type="image/png" href="image/favicon.png" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-slate-50 min-h-screen">
    <div class="w-full max-w-6xl mx-auto p-6">
      <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-3xl font-semibold">Withdrawal History</h2>
          <button
            id="exportBtn"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center"
          >
            <span class="mr-2">üì•</span>Export CSV
          </button>
        </div>

        <!-- Filters Section -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Search</label
              >
              <input
                type="text"
                id="searchInput"
                placeholder="Search by reference, amount..."
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >From Date</label
              >
              <input
                type="date"
                id="fromDate"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >To Date</label
              >
              <input
                type="date"
                id="toDate"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Currency</label
              >
              <select
                id="currencyFilter"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              >
                <option value="all">All Currencies</option>
                <option value="BTC">BTC</option>
                <option value="ETH">ETH</option>
                <option value="USDT">USDT</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Status Tabs -->
        <div class="flex gap-2 mb-6 flex-wrap">
          <button
            class="history-tab px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium transition-all duration-200"
            data-status="all"
          >
            All
          </button>
          <button
            class="history-tab px-4 py-2 rounded-lg bg-slate-100 text-slate-700 font-medium hover:bg-slate-200 transition-all duration-200"
            data-status="pending"
          >
            Pending
          </button>
          <button
            class="history-tab px-4 py-2 rounded-lg bg-slate-100 text-slate-700 font-medium hover:bg-slate-200 transition-all duration-200"
            data-status="completed"
          >
            Completed
          </button>
          <button
            class="history-tab px-4 py-2 rounded-lg bg-slate-100 text-slate-700 font-medium hover:bg-slate-200 transition-all duration-200"
            data-status="cancelled"
          >
            Cancelled
          </button>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto bg-white border border-gray-200 rounded-lg">
          <table class="w-full text-sm" id="withdrawHistoryTable">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="text-left p-4 font-semibold text-gray-700 cursor-pointer hover:bg-gray-100 sortable"
                  data-sort="date"
                >
                  <div class="flex items-center">
                    Date <span class="ml-1 sort-icon">‚ÜïÔ∏è</span>
                  </div>
                </th>
                <th
                  class="text-left p-4 font-semibold text-gray-700 cursor-pointer hover:bg-gray-100 sortable"
                  data-sort="amount"
                >
                  <div class="flex items-center">
                    Amount <span class="ml-1 sort-icon">‚ÜïÔ∏è</span>
                  </div>
                </th>
                <th class="text-left p-4 font-semibold text-gray-700">
                  Currency
                </th>
                <th class="text-left p-4 font-semibold text-gray-700">
                  Method
                </th>
                <th class="text-left p-4 font-semibold text-gray-700">
                  Status
                </th>
                <th class="text-left p-4 font-semibold text-gray-700">
                  Reference
                </th>
                <th class="text-left p-4 font-semibold text-gray-700">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Dynamic rows will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-between mt-6">
          <div class="text-sm text-gray-700">
            Showing <span id="showingCount">0</span> of
            <span id="totalCount">0</span> withdrawals
          </div>
          <div class="flex gap-2" id="pagination">
            <!-- Pagination buttons will be inserted here -->
          </div>
        </div>

        <!-- Back Link -->
        <div class="mt-6 text-center">
          <a
            href="withdraw.html"
            class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200"
          >
            <span class="mr-2">‚¨ÖÔ∏è</span>Back to Withdraw
          </a>
        </div>
      </div>
    </div>

    <!-- Transaction Details Modal -->
    <div
      id="modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800">Transaction Details</h3>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700">
            <span class="text-2xl">&times;</span>
          </button>
        </div>
        <div id="modalContent">
          <!-- Modal content will be inserted here -->
        </div>
      </div>
    </div>

    <script>
      (function () {
        // Sample data - in a real app, this would come from an API
        const sampleData = [
          {
            date: "2026-01-18",
            amount: 0.005,
            currency: "BTC",
            method: "Bank Transfer",
            status: "pending",
            reference: "Ref123",
            details:
              "Withdrawal to external bank account. Processing time: 1-3 business days.",
          },
          {
            date: "2025-12-30",
            amount: 150,
            currency: "USDT",
            method: "PayPal",
            status: "completed",
            reference: "Order789",
            details:
              "Successful withdrawal to PayPal account. Completed on 2025-12-31.",
          },
          {
            date: "2025-11-12",
            amount: 0.01,
            currency: "ETH",
            method: "Bank Transfer",
            status: "cancelled",
            reference: "UserCancel",
            details: "User cancelled the withdrawal request.",
          },
          {
            date: "2026-01-15",
            amount: 0.002,
            currency: "BTC",
            method: "Crypto Wallet",
            status: "completed",
            reference: "Txn456",
            details:
              "Direct transfer to external crypto wallet. Confirmed on blockchain.",
          },
          {
            date: "2026-01-10",
            amount: 200,
            currency: "USDT",
            method: "Bank Transfer",
            status: "pending",
            reference: "Ref789",
            details:
              "Bank transfer in progress. Expected completion: 2026-01-13.",
          },
          {
            date: "2025-12-25",
            amount: 0.05,
            currency: "ETH",
            method: "PayPal",
            status: "completed",
            reference: "Order123",
            details: "Holiday withdrawal processed successfully.",
          },
          {
            date: "2025-11-30",
            amount: 100,
            currency: "USDT",
            method: "Cash App",
            status: "cancelled",
            reference: "Cancel001",
            details: "Cancelled due to incorrect recipient information.",
          },
          {
            date: "2026-01-05",
            amount: 0.001,
            currency: "BTC",
            method: "Bank Transfer",
            status: "completed",
            reference: "Txn999",
            details: "Small withdrawal for testing purposes.",
          },
          {
            date: "2025-12-15",
            amount: 300,
            currency: "USDT",
            method: "Wire Transfer",
            status: "pending",
            reference: "Wire456",
            details:
              "International wire transfer. Processing time: 3-5 business days.",
          },
          {
            date: "2025-10-20",
            amount: 0.02,
            currency: "ETH",
            method: "Crypto Wallet",
            status: "completed",
            reference: "Eth789",
            details: "Large ETH withdrawal to personal wallet.",
          },
        ];

        let currentData = [...sampleData];
        let filteredData = [...sampleData];
        let currentPage = 1;
        const itemsPerPage = 5;
        let currentSort = { column: "date", direction: "desc" };
        let currentStatusFilter = "all";

        const tableBody = document.getElementById("tableBody");
        const searchInput = document.getElementById("searchInput");
        const fromDate = document.getElementById("fromDate");
        const toDate = document.getElementById("toDate");
        const currencyFilter = document.getElementById("currencyFilter");
        const exportBtn = document.getElementById("exportBtn");
        const modal = document.getElementById("modal");
        const closeModal = document.getElementById("closeModal");
        const modalContent = document.getElementById("modalContent");
        const showingCount = document.getElementById("showingCount");
        const totalCount = document.getElementById("totalCount");
        const pagination = document.getElementById("pagination");

        // Initialize
        function init() {
          renderTable();
          setupEventListeners();
          updatePagination();
        }

        // Setup event listeners
        function setupEventListeners() {
          // Tab filtering
          document.querySelectorAll(".history-tab").forEach((tab) => {
            tab.addEventListener("click", () => {
              setActiveTab(tab);
              currentStatusFilter = tab.dataset.status;
              filterData();
            });
          });

          // Search
          searchInput.addEventListener("input", debounce(filterData, 300));

          // Date filters
          fromDate.addEventListener("change", filterData);
          toDate.addEventListener("change", filterData);

          // Currency filter
          currencyFilter.addEventListener("change", filterData);

          // Sorting
          document.querySelectorAll(".sortable").forEach((header) => {
            header.addEventListener("click", () =>
              sortData(header.dataset.sort),
            );
          });

          // Export
          exportBtn.addEventListener("click", exportToCSV);

          // Modal
          closeModal.addEventListener("click", () =>
            modal.classList.add("hidden"),
          );
          modal.addEventListener("click", (e) => {
            if (e.target === modal) modal.classList.add("hidden");
          });
        }

        // Set active tab
        function setActiveTab(activeTab) {
          document.querySelectorAll(".history-tab").forEach((tab) => {
            tab.classList.remove("bg-indigo-600", "text-white");
            tab.classList.add("bg-slate-100", "text-slate-700");
          });
          activeTab.classList.add("bg-indigo-600", "text-white");
          activeTab.classList.remove("bg-slate-100", "text-slate-700");
        }

        // Filter data
        function filterData() {
          const searchTerm = searchInput.value.toLowerCase();
          const from = fromDate.value;
          const to = toDate.value;
          const currency = currencyFilter.value;

          filteredData = sampleData.filter((item) => {
            const matchesStatus =
              currentStatusFilter === "all" ||
              item.status === currentStatusFilter;
            const matchesSearch =
              !searchTerm ||
              item.reference.toLowerCase().includes(searchTerm) ||
              item.amount.toString().includes(searchTerm) ||
              item.method.toLowerCase().includes(searchTerm);
            const matchesDate =
              (!from || item.date >= from) && (!to || item.date <= to);
            const matchesCurrency =
              currency === "all" || item.currency === currency;

            return (
              matchesStatus && matchesSearch && matchesDate && matchesCurrency
            );
          });

          currentPage = 1;
          renderTable();
          updatePagination();
        }

        // Sort data
        function sortData(column) {
          if (currentSort.column === column) {
            currentSort.direction =
              currentSort.direction === "asc" ? "desc" : "asc";
          } else {
            currentSort.column = column;
            currentSort.direction = "asc";
          }

          filteredData.sort((a, b) => {
            let aVal = a[column];
            let bVal = b[column];

            if (column === "date") {
              aVal = new Date(aVal);
              bVal = new Date(bVal);
            } else if (column === "amount") {
              aVal = parseFloat(aVal);
              bVal = parseFloat(bVal);
            }

            if (currentSort.direction === "asc") {
              return aVal > bVal ? 1 : -1;
            } else {
              return aVal < bVal ? 1 : -1;
            }
          });

          renderTable();
          updateSortIcons();
        }

        // Update sort icons
        function updateSortIcons() {
          document.querySelectorAll(".sort-icon").forEach((icon) => {
            icon.textContent = "‚ÜïÔ∏è";
          });
          const activeHeader = document.querySelector(
            `[data-sort="${currentSort.column}"] .sort-icon`,
          );
          if (activeHeader) {
            activeHeader.textContent =
              currentSort.direction === "asc" ? "‚Üë" : "‚Üì";
          }
        }

        // Render table
        function renderTable() {
          const startIndex = (currentPage - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const pageData = filteredData.slice(startIndex, endIndex);

          tableBody.innerHTML = "";

          if (pageData.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" class="text-center py-8 text-gray-500">
                  <div class="flex flex-col items-center">
                    <span class="text-4xl mb-2">üì≠</span>
                    <p>No withdrawals found matching your criteria.</p>
                  </div>
                </td>
              </tr>
            `;
          } else {
            pageData.forEach((item) => {
              const statusClass = getStatusClass(item.status);
              const statusIcon = getStatusIcon(item.status);
              const row = document.createElement("tr");
              row.className = "hover:bg-gray-50 transition-colors duration-150";
              row.innerHTML = `
                <td class="p-4">${formatDate(item.date)}</td>
                <td class="p-4 font-medium">${formatAmount(item.amount, item.currency)}</td>
                <td class="p-4">${item.currency}</td>
                <td class="p-4">${item.method}</td>
                <td class="p-4">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${statusClass}">
                    <span class="mr-1">${statusIcon}</span>${item.status.charAt(0).toUpperCase() + item.status.slice(1)}
                  </span>
                </td>
                <td class="p-4 font-mono text-sm">${item.reference}</td>
                <td class="p-4">
                  <button class="text-indigo-600 hover:text-indigo-800 font-medium text-sm view-details" data-reference="${item.reference}">
                    View Details
                  </button>
                </td>
              `;
              tableBody.appendChild(row);
            });

            // Add event listeners for view details buttons
            document.querySelectorAll(".view-details").forEach((btn) => {
              btn.addEventListener("click", (e) => {
                const ref = e.target.dataset.reference;
                const item = sampleData.find((d) => d.reference === ref);
                if (item) showModal(item);
              });
            });
          }

          showingCount.textContent = Math.min(endIndex, filteredData.length);
          totalCount.textContent = filteredData.length;
        }

        // Update pagination
        function updatePagination() {
          const totalPages = Math.ceil(filteredData.length / itemsPerPage);
          pagination.innerHTML = "";

          if (totalPages <= 1) return;

          // Previous button
          const prevBtn = document.createElement("button");
          prevBtn.textContent = "Previous";
          prevBtn.className = `px-3 py-1 rounded ${currentPage === 1 ? "bg-gray-200 text-gray-500 cursor-not-allowed" : "bg-indigo-600 text-white hover:bg-indigo-700"}`;
          prevBtn.disabled = currentPage === 1;
          prevBtn.addEventListener("click", () => {
            if (currentPage > 1) {
              currentPage--;
              renderTable();
              updatePagination();
            }
          });
          pagination.appendChild(prevBtn);

          // Page numbers
          for (let i = 1; i <= totalPages; i++) {
            if (
              i === currentPage ||
              i === 1 ||
              i === totalPages ||
              (i >= currentPage - 1 && i <= currentPage + 1)
            ) {
              const pageBtn = document.createElement("button");
              pageBtn.textContent = i;
              pageBtn.className = `px-3 py-1 rounded mx-1 ${i === currentPage ? "bg-indigo-600 text-white" : "bg-gray-200 text-gray-700 hover:bg-gray-300"}`;
              pageBtn.addEventListener("click", () => {
                currentPage = i;
                renderTable();
                updatePagination();
              });
              pagination.appendChild(pageBtn);
            } else if (i === currentPage - 2 || i === currentPage + 2) {
              const dots = document.createElement("span");
              dots.textContent = "...";
              dots.className = "px-2 py-1";
              pagination.appendChild(dots);
            }
          }

          // Next button
          const nextBtn = document.createElement("button");
          nextBtn.textContent = "Next";
          nextBtn.className = `px-3 py-1 rounded ${currentPage === totalPages ? "bg-gray-200 text-gray-500 cursor-not-allowed" : "bg-indigo-600 text-white hover:bg-indigo-700"}`;
          nextBtn.disabled = currentPage === totalPages;
          nextBtn.addEventListener("click", () => {
            if (currentPage < totalPages) {
              currentPage++;
              renderTable();
              updatePagination();
            }
          });
          pagination.appendChild(nextBtn);
        }

        // Show modal
        function showModal(item) {
          modalContent.innerHTML = `
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Reference:</span>
                <span class="font-mono">${item.reference}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Date:</span>
                <span>${formatDate(item.date)}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Amount:</span>
                <span class="font-bold">${formatAmount(item.amount, item.currency)}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Currency:</span>
                <span>${item.currency}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Method:</span>
                <span>${item.method}</span>
              </div>
              <div class="flex justify-between">
                <span class="font-medium text-gray-600">Status:</span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(item.status)}">
                  <span class="mr-1">${getStatusIcon(item.status)}</span>${item.status.charAt(0).toUpperCase() + item.status.slice(1)}
                </span>
              </div>
              <div class="border-t pt-3">
                <span class="font-medium text-gray-600">Details:</span>
                <p class="mt-1 text-sm text-gray-700">${item.details}</p>
              </div>
            </div>
          `;
          modal.classList.remove("hidden");
        }

        // Export to CSV
        function exportToCSV() {
          const headers = [
            "Date",
            "Amount",
            "Currency",
            "Method",
            "Status",
            "Reference",
          ];
          const csvContent = [
            headers.join(","),
            ...filteredData.map((item) =>
              [
                item.date,
                item.amount,
                item.currency,
                item.method,
                item.status,
                item.reference,
              ].join(","),
            ),
          ].join("\n");

          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const link = document.createElement("a");
          const url = URL.createObjectURL(blob);
          link.setAttribute("href", url);
          link.setAttribute(
            "download",
            `withdrawal_history_${new Date().toISOString().split("T")[0]}.csv`,
          );
          link.style.visibility = "hidden";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        // Utility functions
        function getStatusClass(status) {
          switch (status) {
            case "completed":
              return "bg-green-100 text-green-800";
            case "pending":
              return "bg-yellow-100 text-yellow-800";
            case "cancelled":
              return "bg-red-100 text-red-800";
            default:
              return "bg-gray-100 text-gray-800";
          }
        }

        function getStatusIcon(status) {
          switch (status) {
            case "completed":
              return "‚úÖ";
            case "pending":
              return "‚è≥";
            case "cancelled":
              return "‚ùå";
            default:
              return "‚ùì";
          }
        }

        function formatDate(dateStr) {
          const date = new Date(dateStr);
          return date.toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          });
        }

        function formatAmount(amount, currency) {
          if (currency === "BTC") return `${amount.toFixed(8)} ${currency}`;
          if (currency === "ETH") return `${amount.toFixed(6)} ${currency}`;
          return `${amount.toFixed(2)} ${currency}`;
        }

        function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }

        // Initialize the app
        init();
      })();
    </script>

    <script src="/js/app.js"></script>
    <footer class="font-semibold bg-white mt-16 py-8 border-t border-gray-200">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <p>&copy; 2023 ORYX Crypto Exchange. All rights reserved.</p>
        <div class="mt-4 flex justify-center space-x-6">
          <a
            href="/privacy.html"
            class="hover:text-indigo-600 transition-colors"
            >Privacy Policy</a
          >
          <a href="/terms.html" class="hover:text-indigo-600 transition-colors"
            >Terms of Service</a
          >
          <a
            href="/livechat.html"
            class="hover:text-indigo-600 transition-colors"
            >Support</a
          >
        </div>
      </div>
    </footer>
  </body>
</html>
